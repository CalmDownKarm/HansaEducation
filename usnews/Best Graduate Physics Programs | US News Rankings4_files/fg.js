!function($){function Menu(caller,options){var menu=this,caller=$(caller),container=$('<div class="fg-menu-container ui-widget ui-widget-content ui-corner-all">'+options.content+"</div>");this.menuOpen=!1,this.menuExists=!1;var options=jQuery.extend({content:null,width:180,maxHeight:180,positionOpts:{posX:"left",posY:"bottom",offsetX:0,offsetY:0,directionH:"right",directionV:"down",detectH:!0,detectV:!0,linkToFront:!1},showSpeed:200,callerOnState:"ui-state-active",loadingState:"ui-state-loading",linkHover:"ui-state-hover",linkHoverSecondary:"li-hover",crossSpeed:200,crumbDefaultText:"Choose an option:",backLink:!0,backLinkText:"Back",flyOut:!1,flyOutOnState:"ui-state-default",nextMenuLink:"ui-icon-triangle-1-e",topLinkText:"All",nextCrumbLink:"ui-icon-carat-1-e"},options),killAllMenus=function(){$.each(allUIMenus,function(i){allUIMenus[i].menuOpen&&allUIMenus[i].kill()})};this.kill=function(){caller.removeClass(options.loadingState).removeClass("fg-menu-open").removeClass(options.callerOnState),container.find("li").removeClass(options.linkHoverSecondary).find("a").removeClass(options.linkHover),options.flyOutOnState&&container.find("li a").removeClass(options.flyOutOnState),options.callerOnState&&caller.removeClass(options.callerOnState),container.is(".fg-menu-ipod")&&menu.resetDrilldownMenu(),container.is(".fg-menu-flyout")&&menu.resetFlyoutMenu(),container.parent().hide(),menu.menuOpen=!1,$(document).unbind("click",killAllMenus),$(document).unbind("keydown")},this.showLoading=function(){caller.addClass(options.loadingState)},this.showMenu=function(){killAllMenus(),menu.menuExists||menu.create(),caller.addClass("fg-menu-open").addClass(options.callerOnState),container.parent().show().click(function(){return menu.kill(),!1}),container.hide().slideDown(options.showSpeed).find(".fg-menu:eq(0)"),menu.menuOpen=!0,caller.removeClass(options.loadingState),$(document).click(killAllMenus),$(document).keydown(function(event){var e;""!=event.which?e=event.which:""!=event.charCode?e=event.charCode:""!=event.keyCode&&(e=event.keyCode);var menuType=$(event.target).parents("div").is(".fg-menu-flyout")?"flyout":"ipod";switch(e){case 37:return"flyout"==menuType&&($(event.target).trigger("mouseout"),$("."+options.flyOutOnState).size()>0&&$("."+options.flyOutOnState).trigger("mouseover")),"ipod"==menuType&&($(event.target).trigger("mouseout"),$(".fg-menu-footer").find("a").size()>0&&$(".fg-menu-footer").find("a").trigger("click"),$(".fg-menu-header").find("a").size()>0&&$(".fg-menu-current-crumb").prev().find("a").trigger("click"),$(".fg-menu-current").prev().is(".fg-menu-indicator")&&$(".fg-menu-current").prev().trigger("mouseover")),!1;case 38:if($(event.target).is("."+options.linkHover)){var prevLink=$(event.target).parent().prev().find("a:eq(0)");prevLink.size()>0&&($(event.target).trigger("mouseout"),prevLink.trigger("mouseover"))}else container.find("a:eq(0)").trigger("mouseover");return!1;case 39:return $(event.target).is(".fg-menu-indicator")&&("flyout"==menuType?$(event.target).next().find("a:eq(0)").trigger("mouseover"):"ipod"==menuType&&($(event.target).trigger("click"),setTimeout(function(){$(event.target).next().find("a:eq(0)").trigger("mouseover")},options.crossSpeed))),!1;case 40:if($(event.target).is("."+options.linkHover)){var nextLink=$(event.target).parent().next().find("a:eq(0)");nextLink.size()>0&&($(event.target).trigger("mouseout"),nextLink.trigger("mouseover"))}else container.find("a:eq(0)").trigger("mouseover");return!1;case 27:killAllMenus();break;case 13:$(event.target).is(".fg-menu-indicator")&&"ipod"==menuType&&($(event.target).trigger("click"),setTimeout(function(){$(event.target).next().find("a:eq(0)").trigger("mouseover")},options.crossSpeed))}})},this.create=function(){if(container.css({width:options.width}).appendTo("body").find("ul:first").not(".fg-menu-breadcrumb").addClass("fg-menu"),container.find("ul, li a").addClass("ui-corner-all"),container.find("ul").attr("role","menu").eq(0).attr("aria-activedescendant","active-menuitem").attr("aria-labelledby",caller.attr("id")),container.find("li").attr("role","menuitem"),container.find("li:has(ul)").attr("aria-haspopup","true").find("ul").attr("aria-expanded","false"),container.find("a").attr("tabindex","-1"),container.find("ul").size()>1?options.flyOut?menu.flyout(container,options):menu.drilldown(container,options):container.find("a").click(function(){return menu.chooseItem(this),!1}),options.linkHover){container.find(".fg-menu li a").hover(function(){$(this);$("."+options.linkHover).removeClass(options.linkHover).blur().parent().removeAttr("id"),$(this).addClass(options.linkHover).focus().parent().attr("id","active-menuitem")},function(){$(this).removeClass(options.linkHover).blur().parent().removeAttr("id")})}options.linkHoverSecondary&&container.find(".fg-menu li").hover(function(){$(this).siblings("li").removeClass(options.linkHoverSecondary),options.flyOutOnState&&$(this).siblings("li").find("a").removeClass(options.flyOutOnState),$(this).addClass(options.linkHoverSecondary)},function(){$(this).removeClass(options.linkHoverSecondary)}),menu.setPosition(container,caller,options),menu.menuExists=!0},this.chooseItem=function(item){menu.kill(),$("#menuSelection").text($(item).text()),location.href=$(item).attr("href")}}function getScrollTop(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}function getScrollLeft(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft}function getWindowHeight(){var de=document.documentElement;return self.innerHeight||de&&de.clientHeight||document.body.clientHeight}function getWindowWidth(){var de=document.documentElement;return self.innerWidth||de&&de.clientWidth||document.body.clientWidth}function fitHorizontal(el,leftOffset){var leftVal=parseInt(leftOffset)||$(el).offset().left;return leftVal+$(el).width()<=getWindowWidth()+getScrollLeft()&&leftVal-getScrollLeft()>=0}function fitVertical(el,topOffset){var topVal=parseInt(topOffset)||$(el).offset().top;return topVal+$(el).height()<=getWindowHeight()+getScrollTop()&&topVal-getScrollTop()>=0}var allUIMenus=[];$.fn.menu=function(options){var caller=this,options=options,m=new Menu(caller,options);allUIMenus.push(m),$(this).mousedown(function(){m.menuOpen||m.showLoading()}).click(function(){return 0==m.menuOpen?m.showMenu():m.kill(),!1})},Menu.prototype.flyout=function(container,options){var menu=this;this.resetFlyoutMenu=function(){container.find("ul ul").removeClass("ui-widget-content").hide()},container.addClass("fg-menu-flyout").find("li:has(ul)").each(function(){var showTimer,hideTimer,linkWidth=container.width(),allSubLists=$(this).find("ul");allSubLists.css({left:linkWidth,width:linkWidth}).hide(),$(this).find("a:eq(0)").addClass("fg-menu-indicator").html("<span>"+$(this).find("a:eq(0)").text()+'</span><span class="ui-icon '+options.nextMenuLink+'"></span>').hover(function(){clearTimeout(hideTimer);var subList=$(this).next();fitVertical(subList,$(this).offset().top)||subList.css({top:"auto",bottom:0}),fitHorizontal(subList,$(this).offset().left+100)||subList.css({left:"auto",right:linkWidth,"z-index":999}),showTimer=setTimeout(function(){subList.addClass("ui-widget-content").show(options.showSpeed).attr("aria-expanded","true")},300)},function(){clearTimeout(showTimer);var subList=$(this).next();hideTimer=setTimeout(function(){subList.removeClass("ui-widget-content").hide(options.showSpeed).attr("aria-expanded","false")},400)}),$(this).find("ul a").hover(function(){clearTimeout(hideTimer),$(this).parents("ul").prev().is("a.fg-menu-indicator")&&$(this).parents("ul").prev().addClass(options.flyOutOnState)},function(){hideTimer=setTimeout(function(){allSubLists.hide(options.showSpeed),container.find(options.flyOutOnState).removeClass(options.flyOutOnState)},500)})}),container.find("a").click(function(){return menu.chooseItem(this),!1})},Menu.prototype.drilldown=function(container,options){var menu=this,topList=container.find(".fg-menu"),breadcrumb=$('<ul class="fg-menu-breadcrumb ui-widget-header ui-corner-all ui-helper-clearfix"></ul>'),crumbDefaultHeader=$('<li class="fg-menu-breadcrumb-text">'+options.crumbDefaultText+"</li>"),firstCrumbText=options.backLink?options.backLinkText:options.topLinkText,firstCrumbClass=options.backLink?"fg-menu-prev-list":"fg-menu-all-lists",firstCrumbLinkClass=options.backLink?"ui-state-default ui-corner-all":"",firstCrumbIcon=options.backLink?'<span class="ui-icon ui-icon-triangle-1-w"></span>':"",firstCrumb=$('<li class="'+firstCrumbClass+'"><a href="#" class="'+firstCrumbLinkClass+'">'+firstCrumbIcon+firstCrumbText+"</a></li>");container.addClass("fg-menu-ipod"),options.backLink?breadcrumb.addClass("fg-menu-footer").appendTo(container).hide():breadcrumb.addClass("fg-menu-header").prependTo(container),breadcrumb.append(crumbDefaultHeader);var checkMenuHeight=function(el){el.height()>options.maxHeight&&el.addClass("fg-menu-scroll"),el.css({height:options.maxHeight})},resetChildMenu=function(el){el.removeClass("fg-menu-scroll").removeClass("fg-menu-current").height("auto")};this.resetDrilldownMenu=function(){$(".fg-menu-current").removeClass("fg-menu-current"),topList.animate({left:0},options.crossSpeed,function(){$(this).find("ul").each(function(){$(this).hide(),resetChildMenu($(this))}),topList.addClass("fg-menu-current")}),$(".fg-menu-all-lists").find("span").remove(),breadcrumb.empty().append(crumbDefaultHeader),$(".fg-menu-footer").empty().hide(),checkMenuHeight(topList)},topList.addClass("fg-menu-content fg-menu-current ui-widget-content ui-helper-clearfix").css({width:container.width()}).find("ul").css({width:container.width(),left:container.width()}).addClass("ui-widget-content").hide(),checkMenuHeight(topList),topList.find("a").each(function(){$(this).next().is("ul")?$(this).addClass("fg-menu-indicator").each(function(){$(this).html("<span>"+$(this).text()+'</span><span class="ui-icon '+options.nextMenuLink+'"></span>')}).click(function(){var nextList=$(this).next(),parentUl=$(this).parents("ul:eq(0)"),parentLeft=parentUl.is(".fg-menu-content")?0:parseFloat(topList.css("left")),nextLeftVal=Math.round(parentLeft-parseFloat(container.width())),footer=$(".fg-menu-footer");resetChildMenu(parentUl),checkMenuHeight(nextList),topList.animate({left:nextLeftVal},options.crossSpeed),nextList.show().addClass("fg-menu-current").attr("aria-expanded","true");var setPrevMenu=function(backlink){var b=backlink,c=$(".fg-menu-current"),prevList=c.parents("ul:eq(0)");c.hide().attr("aria-expanded","false"),resetChildMenu(c),checkMenuHeight(prevList),prevList.addClass("fg-menu-current").attr("aria-expanded","true"),prevList.hasClass("fg-menu-content")&&(b.remove(),footer.hide())};if(options.backLink)0==footer.find("a").size()&&(footer.show(),$('<a href="#"><span class="ui-icon ui-icon-triangle-1-w"></span> <span>Back</span></a>').appendTo(footer).click(function(){var b=$(this),prevLeftVal=parseFloat(topList.css("left"))+container.width();return topList.animate({left:prevLeftVal},options.crossSpeed,function(){setPrevMenu(b)}),!1}));else{1==breadcrumb.find("li").size()&&(breadcrumb.empty().append(firstCrumb),firstCrumb.find("a").click(function(){return menu.resetDrilldownMenu(),!1})),$(".fg-menu-current-crumb").removeClass("fg-menu-current-crumb");var crumbText=$(this).find("span:eq(0)").text(),newCrumb=$('<li class="fg-menu-current-crumb"><a href="javascript://" class="fg-menu-crumb">'+crumbText+"</a></li>");newCrumb.appendTo(breadcrumb).find("a").click(function(){if($(this).parent().is(".fg-menu-current-crumb"))menu.chooseItem(this);else{var newLeftVal=180*-($(".fg-menu-current").parents("ul").size()-1);topList.animate({left:newLeftVal},options.crossSpeed,function(){setPrevMenu()}),$(this).parent().addClass("fg-menu-current-crumb").find("span").remove(),$(this).parent().nextAll().remove()}return!1}),newCrumb.prev().append(' <span class="ui-icon '+options.nextCrumbLink+'"></span>')}return!1}):$(this).click(function(){return menu.chooseItem(this),!1})})},Menu.prototype.setPosition=function(widget,caller,options){var xVal,yVal,el=widget,referrer=caller,dims={refX:referrer.offset().left,refY:referrer.offset().top,refW:referrer.getTotalWidth(),refH:referrer.getTotalHeight()},options=options,helper=$('<div class="positionHelper"></div>');switch(helper.css({position:"absolute",left:dims.refX,top:dims.refY,width:dims.refW,height:dims.refH}),el.wrap(helper),options.positionOpts.posX){case"left":xVal=0;break;case"center":xVal=dims.refW/2;break;case"right":xVal=dims.refW}switch(options.positionOpts.posY){case"top":yVal=0;break;case"center":yVal=dims.refH/2;break;case"bottom":yVal=dims.refH}xVal+=options.positionOpts.offsetX,yVal+=options.positionOpts.offsetY,"up"==options.positionOpts.directionV?(el.css({top:"auto",bottom:yVal}),options.positionOpts.detectV&&!fitVertical(el)&&el.css({bottom:"auto",top:yVal})):(el.css({bottom:"auto",top:yVal}),options.positionOpts.detectV&&!fitVertical(el)&&el.css({top:"auto",bottom:yVal})),"left"==options.positionOpts.directionH?(el.css({left:"auto",right:xVal}),options.positionOpts.detectH&&!fitHorizontal(el)&&el.css({right:"auto",left:xVal})):(el.css({right:"auto",left:xVal}),options.positionOpts.detectH&&!fitHorizontal(el)&&el.css({left:"auto",right:xVal})),options.positionOpts.linkToFront&&referrer.clone().addClass("linkClone").css({position:"absolute",top:0,right:"auto",bottom:"auto",left:0,width:referrer.width(),height:referrer.height()}).insertAfter(el)},jQuery.fn.getTotalWidth=function(){return $(this).width()+parseInt($(this).css("paddingRight"))+parseInt($(this).css("paddingLeft"))+parseInt($(this).css("borderRightWidth"))+parseInt($(this).css("borderLeftWidth"))},jQuery.fn.getTotalHeight=function(){return $(this).height()+parseInt($(this).css("paddingTop"))+parseInt($(this).css("paddingBottom"))+parseInt($(this).css("borderTopWidth"))+parseInt($(this).css("borderBottomWidth"))},Number.prototype.pxToEm=String.prototype.pxToEm=function(settings){settings=jQuery.extend({scope:"body",reverse:!1},settings);var scopeVal,pxVal=""==this?0:parseFloat(this),getWindowWidth=function(){var de=document.documentElement;return self.innerWidth||de&&de.clientWidth||document.body.clientWidth};if("body"==settings.scope&&$.browser.msie&&(parseFloat($("body").css("font-size"))/getWindowWidth()).toFixed(1)>0){scopeVal=function(){return 16*(parseFloat($("body").css("font-size"))/getWindowWidth()).toFixed(3)}()}else scopeVal=parseFloat(jQuery(settings.scope).css("font-size"));return 1==settings.reverse?(pxVal*scopeVal).toFixed(2)+"px":(pxVal/scopeVal).toFixed(2)+"em"}}(jQuery);