!function(){"use strict";var PARAM_NAME="col",COLUMN_SEPARATOR=":",getColumnOrderFromUrl=function(url){return($.deparam(url)[PARAM_NAME]||"").split(COLUMN_SEPARATOR)},saveColumnOrderInUrls=function($urls,$headers){var columnIds=$headers.map(function(){return $(this).attr("data-columnizer-id")});$urls.each(function(){var url=$(this).attr("href")||"",urlParts=url.split("?"),params=$.deparam(urlParts[1]);params[PARAM_NAME]=columnIds.toArray().join(COLUMN_SEPARATOR),url=urlParts[0]+"?"+$.param(params),$(this).attr("href",url)})},columnize=function($table,options){var $headers,DEFAULT_OPTION_VALUE="default",getColumnHeaders=function($table,options){var $headers=$table.find("thead > tr > th");return options.columnSelector?$headers.filter(options.columnSelector):$headers},swapColumns=function(columnId1,columnId2){var didSwap=!1;return $headers.filter("[data-columnizer-id="+columnId1+"]").length&&$headers.filter("[data-columnizer-id="+columnId2+"]").length&&($table.find("> thead > tr, > tbody > tr").each(function(){var $row=$(this),$target=$row.find("> [data-columnizer-id="+columnId1+"]"),$source=$row.find("> [data-columnizer-id="+columnId2+"]"),sourceIndex=$source.index();$target.replaceWith($source),sourceIndex<$row.children().length?$target.insertBefore($row.find(":nth-child("+(sourceIndex+1)+")")):$row.append($target)}),resetSelectFields($headers),saveColumnOrderInUrls($(options.linkSelector),getColumnHeaders($table,options)),didSwap=!0,"function"==typeof options.columnDidChange&&options.columnDidChange($table)),didSwap},onColumnSelected=function(e){var $select=$(this);"function"==typeof options.columnWillChange&&!1===options.columnWillChange(e,$table,$select)||$select.val()!==DEFAULT_OPTION_VALUE&&swapColumns($select.attr("data-columnizer-id"),$select.val())},addSelectFields=function($headers){var $selectFields=[];return $headers.each(function(){var $header=$(this),$container=$('<div class="columnizer_container"></div>').width("100%"),$form=$('<form class="columnizer"></form>'),$select=$('<select class="columnizer_select" data-columnizer-id="'+$header.attr("data-columnizer-id")+'"></select>');$container.append($form),$form.append($select),$selectFields.push($selectFields),$header.prepend($container)}),$selectFields},populateSelectField=function($selectField,$headers){$selectField.empty().append('<option selected value="'+DEFAULT_OPTION_VALUE+'">Change Column</option>'),$headers.each(function(){var $header=$(this);$selectField.append('<option value="'+$header.attr("data-columnizer-id")+'">'+$header.attr("data-label")+"</option>")})},indexOf=function(items,item,start){var i;if(items&&items.length)for(i=start;i<items.length&&items[i]!==item;i++);return void 0!==i?i:-1},sortColumns=function(order,$headers){var i,j,temp,headerOrder=$headers.map(function(){return $(this).attr("data-columnizer-id")});for(i=0;i<order.length&&i<headerOrder.length;i++)order[i]&&order[i]!==headerOrder[i]&&swapColumns(order[i],headerOrder[i])&&(j=indexOf(headerOrder,order[i],i+1),temp=headerOrder[i],headerOrder[i]=headerOrder[j],headerOrder[j]=temp)},resetSelectFields=function($headers){var $invisible=$headers.filter(":not(:visible)");$headers.filter(":visible").find("select").each(function(){populateSelectField($(this),$invisible)})};options=$.extend({columnSelector:null,linkSelector:null},options),$headers=getColumnHeaders($table,options),$headers.each(function(i){var $cell=$(this);$cell.attr("data-columnizer-id",$cell.index()),$cell.attr("data-label",$cell.text())}),$table.find("> tbody > tr > td").each(function(){var $cell=$(this);$cell.attr("data-columnizer-id",$cell.index())}),addSelectFields($headers),sortColumns(getColumnOrderFromUrl(window.location.href),$headers),resetSelectFields($headers),$table.on("change","select.columnizer_select",onColumnSelected)};$.fn.columnizer=function(options){$(this).filter("table").each(function(){columnize($(this),options)})}}();